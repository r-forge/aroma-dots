%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Author: Pierre Neuvial, pierre@stat.berkeley.edu
% Created on: 2009-06-24
%
% Usage:
%  library("R.rsp");
%  rsptex("mBafDetectionPowerAndPurity.tex.rsp");  # => *.tex.rsp => ... => *.dvi
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 

<%
source("R/figDevice.R")
%>

<%
kappas <- seq(0.5, 1, by=0.1)
figDev <- function(..., force=(figForce > 0)) { pdfDev(..., path=figPath, force=force) }

figPath <- "figures/col"
figForce <- TRUE
%>

\title{Detection power of mirrored allele B fractions and tumor purity}

<%
truePurity <- NA;
## mBAF: rho-1/2
mBAF <- function(C1, C2, kappa) {
  kappa*(C2-C1)/(kappa*(C1+C2) +2*(1-kappa))
}
%>
  
\documentclass{article}
\usepackage{graphicx}
\graphicspath{{<%=figPath%>/}}

\begin{document}

\maketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Setup
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
<%
pcns <-rbind(c(0,0), c(0,1), c(1,1), c(0, 2), c(1,2), c(1,3));
o <- c(4, 2, 6, 5, 3, 1);
colnames(pcns) <- c("C[1]", "C[2]")
labels <- c("homozygous deletion", "hemizygous deletion", "normal", "copy neutral LOH", "gain", "gain");
labels <- "";
labs <- apply(cbind(labels, pcns), 1, function(x) sprintf("%s (%s,%s)", x[1], x[2], x[3]))
cex.axis <- 2.2;
cex.lab <- 2.5;
lwd <- 5;
mar <- c(4.9,5,2.2,1.2)
%>

\begin{displaymath}
  mBAF = \frac{\kappa(C2-C1)}{\kappa(C1+C2) +2(1-\kappa)}
\end{displaymath}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% BEGIN TABLE
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  
<%
res <- NULL
for (kappa in kappas) {
  res <- cbind(res, apply(pcns, 1, function(pcn) mBAF(pcn[1], pcn[2], kappa)))
}
colnames(res) <- sprintf("kappa=%s", kappas)
rownames(res) <- labs
caption <- "Mirrored BAF for various PCNs and purities. Gains are much closer to 0, ie much harder to distinguish from the noise."
require(xtable)
%>

<%=print(xtable(res, caption=caption))%>

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% END TABLE
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\clearpage

\section{Power vs tumor purity}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% BEGIN PLOT
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
<%
figName <-sprintf("mBAFVsTumorPurity")
figDev(figName, width=480)
par(cex.axis=cex.axis, cex.lab=cex.lab, lwd=lwd, mar=mar);
## ylab <- substitute(paste(rho, " for Heterozygous SNPs"));
ylab <- expression(rho);
%>

%% plot mBAF(kappa) for a few (m,M) couples.
<%
plot(NA, xlim=c(0,1), ylim=c(0, 1), xlab="Tumor purity", ylab=ylab, axes=FALSE);
axis(1, a=seq(0, 1, by=0.5));
axis(2, a=seq(0, 1, by=0.5));
abline(v=truePurity, lty=1, col="lightgray")
for (hh in 1:nrow(pcns)) {
  curve(mBAF(pcns[o[hh],1], pcns[o[hh],2], x), add=TRUE, col=hh, lty=hh)
}
legend("topleft", labs[o], lty=1:nrow(pcns), col=1:nrow(pcns), cex=1.3, bty='n')
## box();
devDone()
%>

\begin{figure}[htp]
  \centering
   \resizebox{0.99\columnwidth}{!}{\includegraphics{<%=figName%>}}
 \caption{Power of specific PCN regions as a function of tumor purity. Power is measured as the true mirrored allele B fraction ($\rho$) for heterozygous SNPs. }
  \label{fig:<%=figName%>}
\end{figure}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% END PLOT
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\clearpage

\section{Differences in power vs tumor purity}

<% ## Define pairs of PCNs of interest
regions <- rbind(
       c(3, 2), ## normal to deletion
       c(5, 4), ## gain to copy neutral LOH
        c(3, 5), ## normal to gain
        c(2, 4)) ## deletion to copy neutral LOH
pcnLabs <- apply(pcns, 1, function(x) sprintf("(%s,%s)", x[1], x[2]));
deltaLabs <- apply(regions, 1, function(x) sprintf("%s to %s", pcnLabs[x[1]], pcnLabs[x[2]]));
%>

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% BEGIN PLOT
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
<%
figName <-sprintf("deltaMBAFVsTumorPurity");
figDev(figName, width=480);
ylab <- substitute(paste("Difference in ", rho));
par(cex.axis=cex.axis, cex.lab=cex.lab, lwd=lwd, mar=mar);
%>

%% plot delta(mBAF(kappa)) for a few (m,M) couples.
<%
plot(NA, xlim=c(0,1), ylim=c(0, 1), xlab="Tumor purity", ylab=ylab, axes=FALSE);
axis(1, a=seq(0, 1, by=0.5));
axis(2, a=seq(0, 1, by=0.5));
abline(v=truePurity, lty=1, col="lightgray")
for (rr in 1:nrow(regions)) {
  reg <- regions[rr,];
  curve(mBAF(pcns[reg[2],1], pcns[reg[2],2], x) -mBAF(pcns[reg[1],1], pcns[reg[1],2], x), add=TRUE, col=rr, lty=rr)
}
legend("topleft", deltaLabs, lty=1:nrow(regions), col=1:nrow(regions), cex=1.5, bty='n')
devDone()
%>

\begin{figure}[htp]
  \centering
   \resizebox{0.99\columnwidth}{!}{\includegraphics{<%=figName%>}}
 \caption{Expected differences in power between specific PCN regions,  as a function of tumor purity. Power is measured as the true mirrored allele B fraction ($\rho_{\textrm{true}}$) for heterozygous SNPs.}
  \label{fig:<%=figName%>}
\end{figure}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% END PLOT
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Session information
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Session information}
This report was automatically generated using the R.rsp package.
<%=toLatex(sessionInfo())%>
\end{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% HISTORY:
% 2009-06-24
% o Created.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
